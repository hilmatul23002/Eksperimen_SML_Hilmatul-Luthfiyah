# -*- coding: utf-8 -*-
"""Experiment_Hilmatul-Luthfiyah-H

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kcnfYkeFMdT4jR5RAplppiC4lKj_VRDW

# **1. Perkenalan Dataset**

Tahap pertama, Anda harus mencari dan menggunakan dataset dengan ketentuan sebagai berikut:

1. **Sumber Dataset**:  
   Dataset dapat diperoleh dari berbagai sumber, seperti public repositories (*Kaggle*, *UCI ML Repository*, *Open Data*) atau data primer yang Anda kumpulkan sendiri.

# **2. Import Library**

Pada tahap ini, Anda perlu mengimpor beberapa pustaka (library) Python yang dibutuhkan untuk analisis data dan pembangunan model machine learning atau deep learning.
"""

!pip install kaggle pandas

!pip install feature-engine

import pandas as pd
import os
import kagglehub
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import MinMaxScaler, StandardScaler, OneHotEncoder
from feature_engine.outliers import Winsorizer
from google.colab import files

"""# **3. Memuat Dataset**

Pada tahap ini, Anda perlu memuat dataset ke dalam notebook. Jika dataset dalam format CSV, Anda bisa menggunakan pustaka pandas untuk membacanya. Pastikan untuk mengecek beberapa baris awal dataset untuk memahami strukturnya dan memastikan data telah dimuat dengan benar.

Jika dataset berada di Google Drive, pastikan Anda menghubungkan Google Drive ke Colab terlebih dahulu. Setelah dataset berhasil dimuat, langkah berikutnya adalah memeriksa kesesuaian data dan siap untuk dianalisis lebih lanjut.

Jika dataset berupa unstructured data, silakan sesuaikan dengan format seperti kelas Machine Learning Pengembangan atau Machine Learning Terapan
"""

# Mengunduh dataset dari kaggle
dataset_path = kagglehub.dataset_download('puanbeningpastika/dataset-pendidikan-sd-indonesia-2023-2024')
print("Dataset berhasil diunduh di folder:", dataset_path)

files = os.listdir(dataset_path)
file_path = os.path.join(dataset_path, files[0])

df = pd.read_csv(file_path)
# Drop the 'Unnamed: 14' column as it appears to contain only NaN values
if 'Unnamed: 14' in df.columns:
    df = df.drop(columns=['Unnamed: 14'])

csv_output_path = 'Data-Sekolah.csv'
df.to_csv(csv_output_path, index=False)
print("CSV berhasil disimpan di:", csv_output_path)

df.head()

"""# **4. Exploratory Data Analysis (EDA)**

Pada tahap ini, Anda akan melakukan **Exploratory Data Analysis (EDA)** untuk memahami karakteristik dataset.

Tujuan dari EDA adalah untuk memperoleh wawasan awal yang mendalam mengenai data dan menentukan langkah selanjutnya dalam analisis atau pemodelan.
"""

#Persebaran Provinsi
# --------------------------------------------------------

# 1. HITUNG JUMLAH SEKOLAH PER PROVINSI
# Menghitung frekuensi kemunculan setiap provinsi
distribusi_provinsi = df['Provinsi'].value_counts()

# 2. VISUALISASI HASIL PERSEBARAN (BAR CHART)

# Siapkan data untuk plot
# Kita akan menggunakan 15 provinsi terbanyak agar plot tidak terlalu padat
top_n = 15
data_to_plot = distribusi_provinsi.head(top_n)

# Konfigurasi ukuran plot
plt.figure(figsize=(9, 6))

# Membuat Bar Plot menggunakan Seaborn
sns.barplot(
    x=data_to_plot.index,   # Nama-nama Provinsi
    y=data_to_plot.values,  # Jumlah Sekolah
    palette='viridis'       # Pilihan warna
)

# Menambahkan judul dan label
plt.title(f'Persebaran Jumlah Sekolah SD per Provinsi (Top {top_n})', fontsize=16)
plt.xlabel('Provinsi', fontsize=12)
plt.ylabel('Jumlah Sekolah', fontsize=12)

# Rotasi label x agar nama provinsi tidak bertumpuk
plt.xticks(rotation=45, ha='right')

# Menambahkan grid untuk keterbacaan
plt.grid(axis='y', linestyle='--', alpha=0.7)

# Mengatur layout agar teks tidak terpotong
plt.tight_layout()

# Menampilkan plot
plt.show()

# --------------------------------------------------------
# 2. MENGHITUNG DAN MENAMPILKAN JUMLAH SEKOLAH PER PROVINSI
# --------------------------------------------------------

# Kita menggunakan kolom 'Sekolah' (kolom kedua dari dataset Anda)
# yang sudah berisi total jumlah sekolah per baris provinsi.

# Cukup tampilkan kolom yang relevan: Provinsi dan Sekolah
df_distribusi = df[['Provinsi', 'Sekolah']].sort_values(by='Sekolah', ascending=False).reset_index(drop=True)

# --------------------------------------------------------
# 3. VISUALISASI PERSEBARAN
# --------------------------------------------------------

# Gunakan data distribusi yang sudah diurutkan untuk visualisasi
data_to_plot = df_distribusi.head(15) # Ambil 15 provinsi teratas

plt.figure(figsize=(7, 7))

# Membuat Bar Plot
ax = sns.barplot(
    x=data_to_plot['Provinsi'],
    y=data_to_plot['Sekolah'],
    palette='Spectral'
)

# Menambahkan judul, label, dan memutar label x
plt.title(f'Top 15 Provinsi dengan Jumlah Sekolah SD Terbanyak', fontsize=18, pad=20)
plt.xlabel('Provinsi', fontsize=14)
plt.ylabel('Jumlah Sekolah', fontsize=14)
plt.xticks(rotation=45, ha='right', fontsize=10)

# Menambahkan nilai (label) di atas setiap bar
for p in ax.patches:
    ax.annotate(
        f'{int(p.get_height()):,}',
        (p.get_x() + p.get_width() / 2., p.get_height()),
        ha='center',
        va='center',
        xytext=(0, 10),
        textcoords='offset points',
        fontsize=9
    )

plt.tight_layout()
plt.show()

# --------------------------------------------------------
# 2. MENGHITUNG DAN MENAMPILKAN JUMLAH SEKOLAH PER PROVINSI (TERSEDIKIT)
# --------------------------------------------------------

# Mengurutkan berdasarkan kolom 'Sekolah' secara ASCENDING (dari kecil ke besar)
# menggunakan 'ascending=True'
df_distribusi_terkecil = df[['Provinsi', 'Sekolah']].sort_values(
    by='Sekolah',
    ascending=True  # Perubahan di sini!
).reset_index(drop=True)

# --------------------------------------------------------
# 3. VISUALISASI PERSEBARAN 15 PROVINSI TERSEDIKIT
# --------------------------------------------------------

# Gunakan data distribusi yang sudah diurutkan secara ascending
data_to_plot_terkecil = df_distribusi_terkecil.head(15) # Ambil 15 provinsi teratas (terkecil)

plt.figure(figsize=(7, 7))

# Membuat Bar Plot
ax = sns.barplot(
    x=data_to_plot_terkecil['Provinsi'],   # Nama-nama Provinsi
    y=data_to_plot_terkecil['Sekolah'],  # Jumlah Sekolah
    palette='Reds_d'                     # Menggunakan skema warna yang berbeda untuk membedakan
)

# Menambahkan judul, label, dan memutar label x
plt.title(f'Top 15 Provinsi dengan Jumlah Sekolah SD Tersedikit', fontsize=18, pad=20)
plt.xlabel('Provinsi', fontsize=14)
plt.ylabel('Jumlah Sekolah', fontsize=14)
plt.xticks(rotation=45, ha='right', fontsize=10)

# Menambahkan nilai (label) di atas setiap bar
for p in ax.patches:
    ax.annotate(
        f'{int(p.get_height()):,}',
        (p.get_x() + p.get_width() / 2., p.get_height()),
        ha='center',
        va='center',
        xytext=(0, 10),
        textcoords='offset points',
        fontsize=9
    )

plt.tight_layout()
plt.show()

# ========================================================
# BAGIAN A: SISWA TERBANYAK
# ========================================================

# 1. MENGHITUNG DAN MENAMPILKAN SISWA TERBANYAK
# Mengurutkan berdasarkan kolom 'Siswa' secara DESCENDING (dari besar ke kecil)
df_siswa_terbanyak = df[['Provinsi', 'Siswa']].sort_values(
    by='Siswa',
    ascending=False
).reset_index(drop=True)


# 2. VISUALISASI SISWA TERBANYAK
data_to_plot_max = df_siswa_terbanyak.head(15)

plt.figure(figsize=(7, 6))
ax_max = sns.barplot(
    x=data_to_plot_max['Provinsi'],
    y=data_to_plot_max['Siswa'],
    palette='viridis'
)

# Menambahkan judul, label, dan memutar label x
plt.title('Top 15 Provinsi dengan Jumlah Siswa SD Terbanyak', fontsize=16, pad=20)
plt.xlabel('Provinsi', fontsize=12)
plt.ylabel('Jumlah Siswa', fontsize=12)
plt.xticks(rotation=45, ha='right', fontsize=10)

# Menambahkan nilai di atas bar
for p in ax_max.patches:
    ax_max.annotate(
        f'{int(p.get_height()):,}',
        (p.get_x() + p.get_width() / 2., p.get_height()),
        ha='center', va='center', xytext=(0, 10), textcoords='offset points', fontsize=8
    )

plt.tight_layout()
plt.show() #

# ========================================================
# BAGIAN B: SISWA TERSEDIKIT
# ========================================================

# 1. MENGHITUNG DAN MENAMPILKAN SISWA TERSEDIKIT
# Mengurutkan berdasarkan kolom 'Siswa' secara ASCENDING (dari kecil ke besar)
df_siswa_tersedikit = df[['Provinsi', 'Siswa']].sort_values(
    by='Siswa',
    ascending=True # Perubahan di sini!
).reset_index(drop=True)

# 2. VISUALISASI SISWA TERSEDIKIT
data_to_plot_min = df_siswa_tersedikit.head(15)

plt.figure(figsize=(7, 6))
ax_min = sns.barplot(
    x=data_to_plot_min['Provinsi'],
    y=data_to_plot_min['Siswa'],
    palette='Reds_d'
)

# Menambahkan judul, label, dan memutar label x
plt.title('Top 15 Provinsi dengan Jumlah Siswa SD Tersedikit', fontsize=16, pad=20)
plt.xlabel('Provinsi', fontsize=12)
plt.ylabel('Jumlah Siswa', fontsize=12)
plt.xticks(rotation=45, ha='right', fontsize=10)

# Menambahkan nilai di atas bar
for p in ax_min.patches:
    ax_min.annotate(
        f'{int(p.get_height()):,}',
        (p.get_x() + p.get_width() / 2., p.get_height()),
        ha='center', va='center', xytext=(0, 10), textcoords='offset points', fontsize=8
    )

plt.tight_layout()
plt.show() #

# Hitung rasio Putus Sekolah terhadap Siswa Total
df['Rasio_Putus_Sekolah'] = (df['Putus Sekolah'] / df['Siswa']) * 100

# Urutkan dan tampilkan 10 provinsi dengan Rasio Putus Sekolah tertinggi
df_putus_sekolah = df[[
    'Provinsi',
    'Rasio_Putus_Sekolah'
]].sort_values(by='Rasio_Putus_Sekolah', ascending=False).head(10)

# Visualisasi Rasio Putus Sekolah Tertinggi
plt.figure(figsize=(7, 6))
sns.barplot(
    x='Provinsi',
    y='Rasio_Putus_Sekolah',
    data=df_putus_sekolah,
    palette='Reds'
)
plt.title('Top 10 Provinsi dengan Rasio Putus Sekolah Tertinggi')
plt.ylabel('Rasio Putus Sekolah (%)')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Asumsikan DataFrame 'df' sudah dimuat

# 1. Rasio Siswa per Sekolah (Rata-rata kepadatan sekolah)
df['Siswa_per_Sekolah'] = df['Siswa'] / df['Sekolah']

# 2. Rasio Siswa per Guru (Student-Teacher Ratio)
# Asumsi: Guru = Kepala Sekolah dan Guru (<S1) + Kepala Sekolah dan Guru (>S1) + Tenaga Kependidikan (>S1)
# Namun, untuk akurasi, kita hanya menggunakan kolom yang jelas mengindikasikan pengajar jika ada.
# Karena dataset Anda hanya memiliki 'Kepala Sekolah dan Guru (<S1)' dan 'Kepala Sekolah dan Guru (>S1)',
# kita akan menjumlahkan keduanya sebagai total tenaga pengajar formal (Guru).
df['Total_Guru'] = df['Kepala Sekolah dan Guru(<S1)'] + df['Kepala Sekolah dan Guru(≥ S1)']
df['Rasio_Siswa_Guru'] = df['Siswa'] / df['Total_Guru']

# 3. Persentase Ruang Kelas Rusak Berat (Indikator Kualitas Infrastruktur)
df['Persen_Rusak_Berat'] = (df['Ruang kelas(rusak berat)'] / (df['Ruang kelas(baik)'] + df['Ruang kelas(rusak ringan)'] + df['Ruang kelas(rusak sedang)'] + df['Ruang kelas(rusak berat)'])) * 100

print("DataFrame dengan Rasio Kritis:")
print(df[['Provinsi', 'Siswa_per_Sekolah', 'Rasio_Siswa_Guru', 'Persen_Rusak_Berat']].head())

# Hitung total guru
df['Total_Guru'] = df['Kepala Sekolah dan Guru(<S1)'] + df['Kepala Sekolah dan Guru(≥ S1)']

# Hitung Rasio Siswa-Guru
df['Rasio_Siswa_Guru'] = df['Siswa'] / df['Total_Guru']

# Urutkan dan tampilkan 10 provinsi dengan Rasio Siswa-Guru tertinggi (terburuk)
df_rasio_guru_tertinggi = df[[
    'Provinsi',
    'Rasio_Siswa_Guru'
]].sort_values(by='Rasio_Siswa_Guru', ascending=False).head(10)


# Visualisasi Rasio Siswa-Guru Tertinggi
plt.figure(figsize=(7, 6))
sns.barplot(
    x='Provinsi',
    y='Rasio_Siswa_Guru',
    data=df_rasio_guru_tertinggi,
    palette='plasma'
)
plt.title('Top 10 Provinsi dengan Rasio Siswa per Guru Tertinggi')
plt.ylabel('Rasio Siswa/Guru')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Urutkan dan tampilkan 10 provinsi dengan Persentase Ruang Kelas Rusak Berat tertinggi
df_rusak_berat = df[[
    'Provinsi',
    'Persen_Rusak_Berat'
]].sort_values(by='Persen_Rusak_Berat', ascending=False).head(10)

# Visualisasi Persen Rusak Berat Tertinggi
plt.figure(figsize=(7, 6))
sns.barplot(
    x='Provinsi',
    y='Persen_Rusak_Berat',
    data=df_rusak_berat,
    palette='Oranges'
)
plt.title('Top 10 Provinsi: Persentase Ruang Kelas Rusak Berat')
plt.ylabel('Persentase Rusak Berat (%)')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

# Korelasi antara Rasio Siswa/Guru dan Persentase Ruang Kelas Rusak Berat
# Apakah provinsi yang gurunya sedikit juga memiliki fasilitas yang buruk?

# Tentukan dua variabel
x_var = 'Rasio_Siswa_Guru'
y_var = 'Persen_Rusak_Berat'

# Hitung koefisien korelasi Pearson
correlation = df[x_var].corr(df[y_var])
print(f"\nKoefisien Korelasi (Pearson) antara {x_var} dan {y_var}: {correlation:.2f}")

# Scatter Plot
plt.figure(figsize=(7, 6))
sns.scatterplot(
    x=x_var,
    y=y_var,
    data=df,
    hue='Provinsi', # Gunakan warna berbeda untuk setiap provinsi
    palette='tab20',
    legend=False # Sembunyikan legenda provinsi agar tidak terlalu ramai
)

# Tambahkan garis regresi (opsional, untuk melihat tren)
sns.regplot(
    x=x_var,
    y=y_var,
    data=df,
    scatter=False,
    color='red'
)

plt.title(f'Korelasi antara Rasio Siswa/Guru vs. Persentase Ruang Kelas Rusak Berat\n(Korelasi: {correlation:.2f})')
plt.xlabel('Rasio Siswa per Guru')
plt.ylabel('Persentase Ruang Kelas Rusak Berat (%)')
plt.tight_layout()
plt.show()

"""# **5. Data Preprocessing**

Pada tahap ini, data preprocessing adalah langkah penting untuk memastikan kualitas data sebelum digunakan dalam model machine learning.

Jika Anda menggunakan data teks, data mentah sering kali mengandung nilai kosong, duplikasi, atau rentang nilai yang tidak konsisten, yang dapat memengaruhi kinerja model. Oleh karena itu, proses ini bertujuan untuk membersihkan dan mempersiapkan data agar analisis berjalan optimal.

Berikut adalah tahapan-tahapan yang bisa dilakukan, tetapi **tidak terbatas** pada:
1. Menghapus atau Menangani Data Kosong (Missing Values)
2. Menghapus Data Duplikat
3. Normalisasi atau Standarisasi Fitur
4. Deteksi dan Penanganan Outlier
5. Encoding Data Kategorikal
6. Binning (Pengelompokan Data)

Cukup sesuaikan dengan karakteristik data yang kamu gunakan yah. Khususnya ketika kami menggunakan data tidak terstruktur.
"""

df.info

df.describe

df = df.dropna()

df = df.drop_duplicates()

# Define 'cols' with the numerical columns to be scaled.
# It is crucial to ensure that the DataFrame 'df' is not empty before this step.
# The 'Unnamed: 14' column should ideally be dropped earlier if it causes df to become empty.

# Select all numerical columns, excluding 'Provinsi' as it's categorical.
# If 'Unnamed: 14' was not dropped, it might be included here but will be handled if df is empty.
# Assuming 'Provinsi' is of object/string type and other relevant columns are numerical.
numerical_cols_to_scale = df.select_dtypes(include=['number']).columns.tolist()

# Ensure 'Provinsi' is not in the list if it accidentally was, or if its type changed.
if 'Siswa' in numerical_cols_to_scale:
    numerical_cols_to_scale.remove('Siswa')

cols = numerical_cols_to_scale

# Proceed with scaling only if the DataFrame is not empty and there are columns to scale
if not df.empty and cols:
    scaler = MinMaxScaler()
    df[cols] = scaler.fit_transform(df[cols])
    print("Selected numerical columns have been scaled using MinMaxScaler.")
elif df.empty:
    print("Error: The DataFrame is empty. Please ensure 'Unnamed: 14' is dropped and df.dropna() doesn't remove all rows before this step.")
else:
    print("No numerical columns found to scale.")

winsor = Winsorizer(
    capping_method='iqr',
    tail='both',
    fold=1.5,
    # The column 'Pendapatan' does not exist in the dataframe.
    # Please replace with a valid numerical column you wish to cap for outliers.
    # For example, variables=['Siswa'] or variables=['Mengulang']
    # variables=['Pendapatan']
)

# df = winsor.fit_transform(df)

df_encoded = pd.get_dummies(
    df,
    columns=['Provinsi'],
    drop_first=True
)

from google.colab import files
df.to_csv('datasekolahsiap.csv', index=False)
files.download('datasekolahsiap.csv')